#!/bin/ksh

echo "Content-type: text/html"
echo
echo


echo "$(< /dev/stdin)&$QUERY_STRING" | tr '&' '\n' | while read -r kv
do
    if [[ -n "$kv" ]]
    then
	export "PARAM_$kv"
    fi
done

(echo '

cd '"$(dirname "$SCRIPT_FILENAME")"'

export PATH=".:$PATH"

wsh_urldecode()
{
  string_to_decode="$(sed -e "s/%26/________wsh_ampersand________$$/g" -e "s/%5C/________wsh_backslash________$$/g" -e '"'"'s/%\(..\)/\\x\1/g;'"'"')"
  echo a | sed s/a/"$string_to_decode"/ | sed -e "s/+/ /g" -e "s/________wsh_ampersand________$$/\&/g" -e "s/________wsh_backslash________$$/\\\\/g"
}

wsh_input()
{
   eval "echo \$PARAM_$1"
}

wsh_echo()
{
   echo -n "$*" | sed -e "s/</\&lt;/g" -e "s/>/\&gt;/g" 
}

' ; sed 1d "$SCRIPT_FILENAME" | tr '\n' '霞' | sed -e s/'<?wsh'/'\x0A<?wsh'/g  -e s/'?>'/'?>\x0A'/g | sed -e s/"'"/"'\"'\"'"/g -e s/'^'/"echo -n '"/g -e s/'$'/"'"/g -e s/"^echo -n '<?wsh"//g -e s/"?>'$"//g | tr '霞' '\n') | ksh
